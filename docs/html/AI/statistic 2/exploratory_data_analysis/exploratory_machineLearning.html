

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Exploratory analysis with numeric variables. &mdash; My AI website 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/nbsphinx-code-cells.css?v=2aa19091" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=e031e9a9"></script>
      <script src="../../../_static/doctools.js?v=888ff710"></script>
      <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            My AI website
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">Exploratory analysis with numeric variables.</a><ul>
<li><a class="reference internal" href="#Plot-scatter-plots-colored-by-payment-default.">Plot scatter plots colored by payment default.</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Getting-Started-with-machine-learning!">Getting Started with machine learning!</a></li>
<li><a class="reference internal" href="#Fitting-a-random-forest-classifier">Fitting a random forest classifier</a><ul>
<li><a class="reference internal" href="#Advanced-Topics-in-Machine-Learning!">Advanced Topics in Machine Learning!</a><ul>
<li><a class="reference internal" href="#Getting-scores-from-classifiers">Getting scores from classifiers</a></li>
<li><a class="reference internal" href="#Computing-Sensitivity,-Specificity-from-Confusion-Matrix">Computing Sensitivity, Specificity from Confusion Matrix</a></li>
<li><a class="reference internal" href="#Plotting-ROC">Plotting ROC</a></li>
<li><a class="reference internal" href="#Calculating-Area-under-the-ROC-curve">Calculating Area under the ROC curve</a><ul>
<li><a class="reference internal" href="#Selecting-tuning-parameters-in-K-nearest-neighbour-using-combination-of-grid-search-and-cross-validation.-The-error-metric-is-AUC-instead-of-accuracy">Selecting tuning parameters in K nearest neighbour using combination of grid search and cross validation. The error metric is AUC instead of accuracy</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">My AI website</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Exploratory analysis with numeric variables.</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/AI/statistic 2/exploratory_data_analysis/exploratory_machineLearning.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">credit_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;creditDefaultData.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">credit_data</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(29601, 25)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="n">credit_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
   ID  LIMIT_BAL  SEX  EDUCATION  MARRIAGE  AGE  PAY_0  PAY_2  PAY_3  PAY_4  \
0   1      20000    2          2         1   24      2      2     -1     -1
1   2     120000    2          2         2   26     -1      2      0      0
2   3      90000    2          2         2   34      0      0      0      0
3   4      50000    2          2         1   37      0      0      0      0
4   5      50000    1          2         1   57     -1      0     -1      0

              ...              BILL_AMT4  BILL_AMT5  BILL_AMT6  PAY_AMT1  \
0             ...                      0          0          0         0
1             ...                   3272       3455       3261         0
2             ...                  14331      14948      15549      1518
3             ...                  28314      28959      29547      2000
4             ...                  20940      19146      19131      2000

   PAY_AMT2  PAY_AMT3  PAY_AMT4  PAY_AMT5  PAY_AMT6  \
0       689         0         0         0         0
1      1000      1000      1000         0      2000
2      1500      1000      1000      1000      5000
3      2019      1200      1100      1069      1000
4     36681     10000      9000       689       679

   default payment next month
0                           1
1                           1
2                           0
3                           0
4                           0

[5 rows x 25 columns]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="n">credit_data</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
                 ID       LIMIT_BAL           SEX     EDUCATION      MARRIAGE  \
count  29601.000000    29601.000000  29601.000000  29601.000000  29601.000000
mean   14971.758927   167550.544914      1.603189      1.815479      1.555454
std     8660.184430   129944.020953      0.489244      0.710399      0.518092
min        1.000000    10000.000000      1.000000      1.000000      1.000000
25%     7474.000000    50000.000000      1.000000      1.000000      1.000000
50%    14953.000000   140000.000000      2.000000      2.000000      2.000000
75%    22463.000000   240000.000000      2.000000      2.000000      2.000000
max    30000.000000  1000000.000000      2.000000      4.000000      3.000000

                AGE         PAY_0         PAY_2         PAY_3         PAY_4  \
count  29601.000000  29601.000000  29601.000000  29601.000000  29601.000000
mean      35.464072     -0.014932     -0.131313     -0.163440     -0.218303
std        9.213243      1.124503      1.199642      1.199793      1.172220
min       21.000000     -2.000000     -2.000000     -2.000000     -2.000000
25%       28.000000     -1.000000     -1.000000     -1.000000     -1.000000
50%       34.000000      0.000000      0.000000      0.000000      0.000000
75%       41.000000      0.000000      0.000000      0.000000      0.000000
max       79.000000      8.000000      8.000000      8.000000      8.000000

                  ...                  BILL_AMT4      BILL_AMT5  \
count             ...               29601.000000   29601.000000
mean              ...               43122.554204   40235.545184
std               ...               64196.383913   60699.344884
min               ...             -170000.000000  -81334.000000
25%               ...                2329.000000    1780.000000
50%               ...               19005.000000   18091.000000
75%               ...               54271.000000   50072.000000
max               ...              891586.000000  927171.000000

           BILL_AMT6       PAY_AMT1      PAY_AMT2       PAY_AMT3  \
count   29601.000000   29601.000000  2.960100e+04   29601.000000
mean    38858.449816    5649.560319  5.894788e+03    5198.415898
std     59519.893043   16568.264941  2.308919e+04   17580.914806
min   -339603.000000       0.000000  0.000000e+00       0.000000
25%      1278.000000    1000.000000  8.250000e+02     390.000000
50%     17118.000000    2100.000000  2.007000e+03    1800.000000
75%     49121.000000    5005.000000  5.000000e+03    4500.000000
max    961664.000000  873552.000000  1.684259e+06  896040.000000

            PAY_AMT4       PAY_AMT5       PAY_AMT6  default payment next month
count   29601.000000   29601.000000   29601.000000                29601.000000
mean     4828.659268    4795.032735    5181.326374                    0.223134
std     15711.057992   15244.217154   17657.260739                    0.416355
min         0.000000       0.000000       0.000000                    0.000000
25%       298.000000     259.000000     138.000000                    0.000000
50%      1500.000000    1500.000000    1500.000000                    0.000000
75%      4014.000000    4042.000000    4000.000000                    0.000000
max    621000.000000  426529.000000  528666.000000                    1.000000

[8 rows x 25 columns]
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># the ID variable is of no use in the analysis. We will drop it.</span>
<span class="n">credit_data</span> <span class="o">=</span> <span class="n">credit_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">credit_data</span><span class="p">[</span><span class="s1">&#39;default payment next month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    22996
1     6605
Name: default payment next month, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># introducing factor variables.</span>
<span class="nb">print</span> <span class="s2">&quot;Distribution of Sex: &quot;</span>
<span class="nb">print</span> <span class="n">credit_data</span><span class="p">[</span><span class="s1">&#39;SEX&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Distribution of Sex:
2    17855
1    11746
Name: SEX, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="s2">&quot;Distribution of Education: &quot;</span>
<span class="nb">print</span> <span class="n">credit_data</span><span class="p">[</span><span class="s1">&#39;EDUCATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Distribution of Education:
2    14024
1    10581
3     4873
4      123
Name: EDUCATION, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="s2">&quot;Distribution of marital status&quot;</span>
<span class="nb">print</span> <span class="n">credit_data</span><span class="p">[</span><span class="s1">&#39;MARRIAGE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Distribution of marital status
2    15806
1    13477
3      318
Name: MARRIAGE, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="s2">&quot;Distribution of sex and credit default.&quot;</span>
<span class="nb">print</span> <span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">credit_data</span><span class="p">[</span><span class="s1">&#39;SEX&#39;</span><span class="p">],</span>
                              <span class="n">credit_data</span><span class="p">[</span><span class="s1">&#39;default payment next month&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Distribution of sex and credit default.
default payment next month      0     1
SEX
1                            8885  2861
2                           14111  3744
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="s2">&quot;Distribution of sex and credit default.&quot;</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">credit_data</span><span class="p">[</span><span class="s1">&#39;SEX&#39;</span><span class="p">],</span>
                              <span class="n">credit_data</span><span class="p">[</span><span class="s1">&#39;default payment next month&#39;</span><span class="p">])</span>
       <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">/</span><span class="n">r</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Distribution of sex and credit default.
default payment next month         0         1
SEX
1                           0.756428  0.243572
2                           0.790311  0.209689
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">credit_data</span><span class="p">[</span><span class="s1">&#39;SEX&#39;</span><span class="p">],</span>
                              <span class="n">credit_data</span><span class="p">[</span><span class="s1">&#39;default payment next month&#39;</span><span class="p">])</span>
       <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">/</span><span class="n">r</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
 <span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">stacked</span><span class="o">=</span> <span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.axes._subplots.AxesSubplot at 0x8f79668&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/AI_statistic_2_exploratory_data_analysis_exploratory_machineLearning_12_1.png" src="../../../_images/AI_statistic_2_exploratory_data_analysis_exploratory_machineLearning_12_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="s2">&quot;Distribution of education and credit default.&quot;</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">credit_data</span><span class="p">[</span><span class="s1">&#39;EDUCATION&#39;</span><span class="p">],</span>
                              <span class="n">credit_data</span><span class="p">[</span><span class="s1">&#39;default payment next month&#39;</span><span class="p">])</span>

       <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">/</span><span class="n">r</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">credit_data</span><span class="p">[</span><span class="s1">&#39;EDUCATION&#39;</span><span class="p">],</span>
                              <span class="n">credit_data</span><span class="p">[</span><span class="s1">&#39;default payment next month&#39;</span><span class="p">])</span>
       <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">/</span><span class="n">r</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
 <span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">stacked</span><span class="o">=</span> <span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Distribution of education and credit default.
default payment next month         0         1
EDUCATION
1                           0.807580  0.192420
2                           0.762621  0.237379
3                           0.746973  0.253027
4                           0.943089  0.056911
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.axes._subplots.AxesSubplot at 0x99f07f0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/AI_statistic_2_exploratory_data_analysis_exploratory_machineLearning_13_2.png" src="../../../_images/AI_statistic_2_exploratory_data_analysis_exploratory_machineLearning_13_2.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="s2">&quot;Distribution of marriage and credit default.&quot;</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">credit_data</span><span class="p">[</span><span class="s1">&#39;MARRIAGE&#39;</span><span class="p">],</span>
                              <span class="n">credit_data</span><span class="p">[</span><span class="s1">&#39;default payment next month&#39;</span><span class="p">])</span>
       <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">/</span><span class="n">r</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

<span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">credit_data</span><span class="p">[</span><span class="s1">&#39;MARRIAGE&#39;</span><span class="p">],</span>
                              <span class="n">credit_data</span><span class="p">[</span><span class="s1">&#39;default payment next month&#39;</span><span class="p">])</span>
       <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">/</span><span class="n">r</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
 <span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">stacked</span><span class="o">=</span> <span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Distribution of marriage and credit default.
default payment next month         0         1
MARRIAGE
1                           0.763152  0.236848
2                           0.789384  0.210616
3                           0.735849  0.264151
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.axes._subplots.AxesSubplot at 0x9a132b0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/AI_statistic_2_exploratory_data_analysis_exploratory_machineLearning_14_2.png" src="../../../_images/AI_statistic_2_exploratory_data_analysis_exploratory_machineLearning_14_2.png" />
</div>
</div>
<section id="Exploratory-analysis-with-numeric-variables.">
<h1>Exploratory analysis with numeric variables.<a class="headerlink" href="#Exploratory-analysis-with-numeric-variables." title="Permalink to this heading"></a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">factorVars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SEX&#39;</span><span class="p">,</span> <span class="s1">&#39;EDUCATION&#39;</span><span class="p">,</span> <span class="s1">&#39;MARRIAGE&#39;</span><span class="p">,</span> <span class="s1">&#39;PAY_0&#39;</span><span class="p">,</span> <span class="s1">&#39;PAY_2&#39;</span><span class="p">,</span> <span class="s1">&#39;PAY_3&#39;</span><span class="p">,</span><span class="s1">&#39;PAY_4&#39;</span><span class="p">,</span> <span class="s1">&#39;PAY_5&#39;</span><span class="p">,</span><span class="s1">&#39;PAY_6&#39;</span><span class="p">]</span>
<span class="n">response</span> <span class="o">=</span> <span class="s1">&#39;default payment next month&#39;</span>
<span class="n">factorVars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<span class="n">allCols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">credit_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">numericVars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

<span class="k">for</span> <span class="n">eachvar</span> <span class="ow">in</span> <span class="n">allCols</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">eachvar</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">factorVars</span><span class="p">:</span>
        <span class="n">numericVars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eachvar</span><span class="p">)</span>

<span class="n">numericVars</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;LIMIT_BAL&#39;,
 &#39;AGE&#39;,
 &#39;BILL_AMT1&#39;,
 &#39;BILL_AMT2&#39;,
 &#39;BILL_AMT3&#39;,
 &#39;BILL_AMT4&#39;,
 &#39;BILL_AMT5&#39;,
 &#39;BILL_AMT6&#39;,
 &#39;PAY_AMT1&#39;,
 &#39;PAY_AMT2&#39;,
 &#39;PAY_AMT3&#39;,
 &#39;PAY_AMT4&#39;,
 &#39;PAY_AMT5&#39;,
 &#39;PAY_AMT6&#39;]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="n">response</span>
<span class="nb">print</span> <span class="n">credit_data</span><span class="p">[[</span><span class="s1">&#39;AGE&#39;</span><span class="p">,</span> <span class="n">response</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">response</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
default payment next month
                                           AGE
default payment next month
0                          count  22996.000000
                           mean      35.392851
                           std        9.069673
                           min       21.000000
                           25%       28.000000
                           50%       34.000000
                           75%       41.000000
                           max       79.000000
1                          count   6605.000000
                           mean      35.712036
                           std        9.693160
                           min       21.000000
                           25%       28.000000
                           50%       34.000000
                           75%       42.000000
                           max       75.000000
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="n">credit_data</span><span class="p">[[</span><span class="s1">&#39;AGE&#39;</span><span class="p">,</span> <span class="n">response</span><span class="p">]]</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="n">response</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Axes(0.1,0.15;0.8x0.75)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/AI_statistic_2_exploratory_data_analysis_exploratory_machineLearning_18_1.png" src="../../../_images/AI_statistic_2_exploratory_data_analysis_exploratory_machineLearning_18_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="n">credit_data</span><span class="p">[[</span><span class="s1">&#39;LIMIT_BAL&#39;</span><span class="p">,</span> <span class="n">response</span><span class="p">]]</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="n">response</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Axes(0.1,0.15;0.8x0.75)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/AI_statistic_2_exploratory_data_analysis_exploratory_machineLearning_19_1.png" src="../../../_images/AI_statistic_2_exploratory_data_analysis_exploratory_machineLearning_19_1.png" />
</div>
</div>
<p>Notice how the scales for these 2 measurements are vastly different. To get rid of this we need to variable standardization.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Variable standardization for all numerical variables.</span>
<span class="n">credit_data_std</span> <span class="o">=</span> <span class="n">credit_data</span><span class="p">[</span><span class="n">numericVars</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">)</span><span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">credit_data_std</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>LIMIT_BAL</th>
      <th>AGE</th>
      <th>BILL_AMT1</th>
      <th>BILL_AMT2</th>
      <th>BILL_AMT3</th>
      <th>BILL_AMT4</th>
      <th>BILL_AMT5</th>
      <th>BILL_AMT6</th>
      <th>PAY_AMT1</th>
      <th>PAY_AMT2</th>
      <th>PAY_AMT3</th>
      <th>PAY_AMT4</th>
      <th>PAY_AMT5</th>
      <th>PAY_AMT6</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>2.960100e+04</td>
      <td>2.960100e+04</td>
      <td>2.960100e+04</td>
      <td>2.960100e+04</td>
      <td>2.960100e+04</td>
      <td>2.960100e+04</td>
      <td>2.960100e+04</td>
      <td>2.960100e+04</td>
      <td>2.960100e+04</td>
      <td>2.960100e+04</td>
      <td>2.960100e+04</td>
      <td>2.960100e+04</td>
      <td>2.960100e+04</td>
      <td>2.960100e+04</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>5.598185e-17</td>
      <td>3.713721e-16</td>
      <td>2.787932e-16</td>
      <td>-3.226543e-16</td>
      <td>-7.805017e-16</td>
      <td>-2.131491e-16</td>
      <td>-1.030278e-16</td>
      <td>-1.143941e-18</td>
      <td>4.473466e-16</td>
      <td>1.669123e-17</td>
      <td>-2.145629e-15</td>
      <td>-2.221684e-17</td>
      <td>2.416885e-16</td>
      <td>1.450152e-16</td>
    </tr>
    <tr>
      <th>std</th>
      <td>1.000017e+00</td>
      <td>1.000017e+00</td>
      <td>1.000017e+00</td>
      <td>1.000017e+00</td>
      <td>1.000017e+00</td>
      <td>1.000017e+00</td>
      <td>1.000017e+00</td>
      <td>1.000017e+00</td>
      <td>1.000017e+00</td>
      <td>1.000017e+00</td>
      <td>1.000017e+00</td>
      <td>1.000017e+00</td>
      <td>1.000017e+00</td>
      <td>1.000017e+00</td>
    </tr>
    <tr>
      <th>min</th>
      <td>-1.212470e+00</td>
      <td>-1.569948e+00</td>
      <td>-2.951348e+00</td>
      <td>-1.673922e+00</td>
      <td>-2.952245e+00</td>
      <td>-3.319909e+00</td>
      <td>-2.002849e+00</td>
      <td>-6.358678e+00</td>
      <td>-3.409926e-01</td>
      <td>-2.553094e-01</td>
      <td>-2.956902e-01</td>
      <td>-3.073466e-01</td>
      <td>-3.145530e-01</td>
      <td>-2.934438e-01</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>-9.046398e-01</td>
      <td>-8.101597e-01</td>
      <td>-6.464505e-01</td>
      <td>-6.482005e-01</td>
      <td>-6.387364e-01</td>
      <td>-6.354601e-01</td>
      <td>-6.335521e-01</td>
      <td>-6.314038e-01</td>
      <td>-2.806352e-01</td>
      <td>-2.195778e-01</td>
      <td>-2.735067e-01</td>
      <td>-2.883788e-01</td>
      <td>-2.975626e-01</td>
      <td>-2.856282e-01</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>-2.120221e-01</td>
      <td>-1.589122e-01</td>
      <td>-3.911520e-01</td>
      <td>-3.932754e-01</td>
      <td>-3.872562e-01</td>
      <td>-3.756903e-01</td>
      <td>-3.648296e-01</td>
      <td>-3.652698e-01</td>
      <td>-2.142421e-01</td>
      <td>-1.683841e-01</td>
      <td>-1.933047e-01</td>
      <td>-2.118709e-01</td>
      <td>-2.161533e-01</td>
      <td>-2.084915e-01</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>5.575530e-01</td>
      <td>6.008765e-01</td>
      <td>2.135175e-01</td>
      <td>2.052205e-01</td>
      <td>1.884590e-01</td>
      <td>1.736645e-01</td>
      <td>1.620548e-01</td>
      <td>1.724251e-01</td>
      <td>-3.890397e-02</td>
      <td>-3.875421e-02</td>
      <td>-3.972647e-02</td>
      <td>-5.185348e-02</td>
      <td>-4.939876e-02</td>
      <td>-6.690428e-02</td>
    </tr>
    <tr>
      <th>max</th>
      <td>6.406324e+00</td>
      <td>4.725444e+00</td>
      <td>1.245149e+01</td>
      <td>1.318319e+01</td>
      <td>2.339731e+01</td>
      <td>1.321691e+01</td>
      <td>1.461219e+01</td>
      <td>1.550442e+01</td>
      <td>5.238431e+01</td>
      <td>7.269169e+01</td>
      <td>5.067180e+01</td>
      <td>3.921962e+01</td>
      <td>2.766564e+01</td>
      <td>2.964749e+01</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># add the response column to this.</span>
<span class="n">credit_data_std</span><span class="p">[</span><span class="n">response</span><span class="p">]</span> <span class="o">=</span> <span class="n">credit_data</span><span class="p">[</span><span class="n">response</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="n">credit_data_std</span><span class="p">[[</span><span class="s1">&#39;AGE&#39;</span><span class="p">,</span> <span class="n">response</span><span class="p">]]</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="n">response</span><span class="p">),</span>
<span class="n">credit_data_std</span><span class="p">[[</span><span class="s1">&#39;LIMIT_BAL&#39;</span><span class="p">,</span> <span class="n">response</span><span class="p">]]</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="n">response</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Axes(0.1,0.15;0.8x0.75)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.axes._subplots.AxesSubplot at 0xcce16d8&gt;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/AI_statistic_2_exploratory_data_analysis_exploratory_machineLearning_23_3.png" src="../../../_images/AI_statistic_2_exploratory_data_analysis_exploratory_machineLearning_23_3.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/AI_statistic_2_exploratory_data_analysis_exploratory_machineLearning_23_4.png" src="../../../_images/AI_statistic_2_exploratory_data_analysis_exploratory_machineLearning_23_4.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">eachnumvar</span> <span class="ow">in</span> <span class="n">numericVars</span><span class="p">:</span>
    <span class="n">credit_data_std</span><span class="p">[[</span><span class="n">eachnumvar</span><span class="p">,</span> <span class="n">response</span><span class="p">]]</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="n">response</span><span class="p">)</span>
</pre></div>
</div>
</div>
<section id="Plot-scatter-plots-colored-by-payment-default.">
<h2>Plot scatter plots colored by payment default.<a class="headerlink" href="#Plot-scatter-plots-colored-by-payment-default." title="Permalink to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">credit_data_std</span><span class="p">[</span><span class="n">credit_data_std</span><span class="p">[</span><span class="n">response</span><span class="p">]</span><span class="o">==</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span> <span class="s1">&#39;AGE&#39;</span> <span class="p">,</span>
                                  <span class="n">y</span><span class="o">=</span> <span class="s1">&#39;LIMIT_BAL&#39;</span><span class="p">,</span>
                                  <span class="n">color</span><span class="o">=</span><span class="s1">&#39;Green&#39;</span><span class="p">,</span>
                                  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
<span class="n">credit_data_std</span><span class="p">[</span><span class="n">credit_data_std</span><span class="p">[</span><span class="n">response</span><span class="p">]</span><span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;AGE&#39;</span><span class="p">,</span>
                             <span class="n">y</span><span class="o">=</span><span class="s1">&#39;LIMIT_BAL&#39;</span><span class="p">,</span>
                             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;Red&#39;</span><span class="p">,</span>
                            <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="p">,</span>
                             <span class="n">label</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.axes._subplots.AxesSubplot at 0xa4f9438&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/AI_statistic_2_exploratory_data_analysis_exploratory_machineLearning_26_1.png" src="../../../_images/AI_statistic_2_exploratory_data_analysis_exploratory_machineLearning_26_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">numericVars</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;LIMIT_BAL&#39;,
 &#39;AGE&#39;,
 &#39;BILL_AMT1&#39;,
 &#39;BILL_AMT2&#39;,
 &#39;BILL_AMT3&#39;,
 &#39;BILL_AMT4&#39;,
 &#39;BILL_AMT5&#39;,
 &#39;BILL_AMT6&#39;,
 &#39;PAY_AMT1&#39;,
 &#39;PAY_AMT2&#39;,
 &#39;PAY_AMT3&#39;,
 &#39;PAY_AMT4&#39;,
 &#39;PAY_AMT5&#39;,
 &#39;PAY_AMT6&#39;]
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pandas.tools.plotting</span> <span class="kn">import</span> <span class="n">scatter_matrix</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">]</span>

<span class="n">scatter_matrix</span><span class="p">(</span><span class="n">credit_data_std</span><span class="p">[</span><span class="n">numericVars</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">8</span><span class="p">]],</span>
               <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
               <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span>
               <span class="n">c</span> <span class="o">=</span> <span class="n">credit_data_std</span><span class="p">[</span><span class="n">response</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">colors</span><span class="p">[</span><span class="n">x</span><span class="p">]),</span>
               <span class="n">diagonal</span><span class="o">=</span><span class="s1">&#39;kde&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">AVG_BILL_AMT</span> <span class="o">=</span> <span class="n">credit_data</span><span class="p">[</span><span class="n">numericVars</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">8</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">credit_data_std</span><span class="p">[</span><span class="s1">&#39;AVG_BILL_AMT&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="p">(</span> <span class="n">AVG_BILL_AMT</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">AVG_BILL_AMT</span><span class="p">)</span> <span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">AVG_BILL_AMT</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">credit_data_std</span><span class="p">[[</span><span class="s1">&#39;AVG_BILL_AMT&#39;</span><span class="p">,</span> <span class="n">response</span><span class="p">]]</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="n">response</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="Getting-Started-with-machine-learning!">
<h1>Getting Started with machine learning!<a class="headerlink" href="#Getting-Started-with-machine-learning!" title="Permalink to this heading"></a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">credit_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;C:/Users/eabksar/Dropbox/OtherWork/PythonForDataScience/data/creditDefaultData.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><br/><span></span><span class="c1"># Calculate the size of each partition.</span>
<span class="n">numTrain</span><span class="p">,</span> <span class="n">numTest</span> <span class="o">=</span>  <span class="nb">int</span><span class="p">(</span><span class="mf">0.7</span> <span class="o">*</span> <span class="n">credit_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.2</span> <span class="o">*</span> <span class="n">credit_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span> <span class="n">numTrain</span><span class="p">,</span> <span class="n">numTest</span>

<span class="c1"># Randomly shuffle the original dataset.</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">credit_data</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

<span class="c1"># create the train, test &amp; validate split using list slicing notation.</span>
<span class="n">trainData</span> <span class="o">=</span> <span class="n">credit_data</span><span class="p">[:</span><span class="n">numTrain</span><span class="p">]</span>
<span class="n">testData</span> <span class="o">=</span> <span class="n">credit_data</span><span class="p">[</span><span class="n">numTrain</span><span class="p">:(</span><span class="n">numTrain</span> <span class="o">+</span> <span class="n">numTest</span><span class="p">)]</span>
<span class="n">validateData</span> <span class="o">=</span> <span class="n">credit_data</span><span class="p">[(</span><span class="n">numTrain</span> <span class="o">+</span> <span class="n">numTest</span><span class="p">):</span> <span class="p">]</span>

<span class="nb">print</span> <span class="n">trainData</span><span class="o">.</span><span class="n">shape</span>
<span class="nb">print</span> <span class="n">testData</span><span class="o">.</span><span class="n">shape</span>
<span class="nb">print</span> <span class="n">validateData</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
20720 5920
(20720, 25)
(5920, 25)
(2961, 25)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create groups of variables : response, factor variables &amp; numeric variables.</span>
<span class="n">response</span> <span class="o">=</span> <span class="s1">&#39;default payment next month&#39;</span>
<span class="n">factorVars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SEX&#39;</span><span class="p">,</span> <span class="s1">&#39;EDUCATION&#39;</span><span class="p">,</span> <span class="s1">&#39;MARRIAGE&#39;</span><span class="p">,</span> <span class="s1">&#39;PAY_0&#39;</span><span class="p">,</span>
              <span class="s1">&#39;PAY_2&#39;</span><span class="p">,</span> <span class="s1">&#39;PAY_3&#39;</span><span class="p">,</span> <span class="s1">&#39;PAY_4&#39;</span><span class="p">,</span> <span class="s1">&#39;PAY_5&#39;</span><span class="p">,</span> <span class="s1">&#39;PAY_6&#39;</span><span class="p">]</span>

<span class="n">allCols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">trainData</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">allCols</span>

<span class="c1"># here is another to create the list of numeric variables using list comprehension.</span>
<span class="n">numericVars</span> <span class="o">=</span> <span class="p">[]</span>
<span class="p">[</span><span class="n">numericVars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">allCols</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">factorVars</span> <span class="o">+</span> <span class="p">[</span><span class="n">response</span><span class="p">]]</span>
<span class="nb">print</span> <span class="n">numericVars</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;ID&#39;, &#39;LIMIT_BAL&#39;, &#39;AGE&#39;, &#39;BILL_AMT1&#39;, &#39;BILL_AMT2&#39;, &#39;BILL_AMT3&#39;, &#39;BILL_AMT4&#39;, &#39;BILL_AMT5&#39;, &#39;BILL_AMT6&#39;, &#39;PAY_AMT1&#39;, &#39;PAY_AMT2&#39;, &#39;PAY_AMT3&#39;, &#39;PAY_AMT4&#39;, &#39;PAY_AMT5&#39;, &#39;PAY_AMT6&#39;]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># we saw variable standardization using pandas earlier.. here is another way to standardize the variables.</span>
<span class="c1"># This method has some particular usefulness</span>

<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">preprocessing</span>
<span class="n">trainX</span> <span class="o">=</span> <span class="n">trainData</span><span class="p">[</span><span class="n">numericVars</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">scaler</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trainX</span><span class="p">)</span>

<span class="nb">print</span> <span class="s2">&quot;List of means using the training data: &quot;</span><span class="p">,</span> <span class="n">scaler</span><span class="o">.</span><span class="n">mean_</span>
<span class="nb">print</span> <span class="s2">&quot;List of standard deviations using the training data &quot;</span><span class="p">,</span> <span class="n">scaler</span><span class="o">.</span><span class="n">scale_</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
List of means using the training data:  [  1.49621056e+04   1.67350564e+05   3.54418436e+01   5.11260836e+04
   4.89986165e+04   4.68875680e+04   4.31804374e+04   4.02331394e+04
   3.87423284e+04   5.63362307e+03   5.91165594e+03   5.15585208e+03
   4.74415550e+03   4.76305415e+03   5.09827235e+03]
List of standard deviations using the training data  [  8.66338200e+03   1.29518960e+05   9.20016032e+00   7.36691012e+04
   7.10763540e+04   6.95143308e+04   6.41930457e+04   6.05238544e+04
   5.89344166e+04   1.59664307e+04   2.34045871e+04   1.68728428e+04
   1.48156651e+04   1.46393476e+04   1.70720221e+04]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
C:\Users\eabksar\AppData\Local\Continuum\Anaconda2\lib\site-packages\sklearn\utils\validation.py:420: DataConversionWarning: Data with input dtype int64 was converted to float64 by StandardScaler.
  warnings.warn(msg, DataConversionWarning)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># using scaler object get the standardized values of trainX</span>
<span class="n">trainX_std</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">trainX</span><span class="p">)</span>
<span class="nb">print</span> <span class="n">trainX_std</span><span class="o">.</span><span class="n">shape</span>
<span class="nb">print</span> <span class="n">trainX_std</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(20720L, 15L)
[[ 1.27604837  0.25208229  0.38674939 ...,  0.01726851 -0.32535973
  -0.00575634]
 [ 1.09678812  1.1013788  -0.26541316 ..., -0.20445626  0.48997715
  -0.28240781]
 [ 1.72437213 -1.13767563 -0.70018819 ..., -0.32021212 -0.32535973
  -0.29863319]
 ...,
 [-0.8982757  -0.0567528   2.88670582 ..., -0.32021212 -0.32535973
  -0.29863319]
 [-0.94560133 -0.82884053 -1.13496323 ..., -0.25271599 -0.2821201
  -0.26776397]
 [-1.16803179  0.32929107 -0.59149443 ...,  0.35474914  0.69927609
  -0.27953762]]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
C:\Users\eabksar\AppData\Local\Continuum\Anaconda2\lib\site-packages\sklearn\utils\validation.py:420: DataConversionWarning: Data with input dtype int64 was converted to float64 by StandardScaler.
  warnings.warn(msg, DataConversionWarning)
</pre></div></div>
</div>
<p>ften features are not given as continuous values but categorical. For example a person could have features [“male”, “female”], [“from Europe”, “from US”, “from Asia”], [“uses Firefox”, “uses Chrome”, “uses Safari”, “uses Internet Explorer”]. Such features can be efficiently coded as integers, for instance [“male”, “from US”, “uses Internet Explorer”] could be expressed as [0, 1, 3] while [“female”, “from Asia”, “uses Chrome”] would be [1, 2, 1]. Such integer representation can not be used
directly with scikit-learn estimators, as these expect continuous input, and would interpret the categories as being ordered, which is often not desired (i.e. the set of browsers was ordered arbitrarily). One possibility to convert categorical features to features that can be used with scikit-learn estimators is to use a one-of-K or one-hot encoding, which is implemented in OneHotEncoder. This estimator transforms each categorical feature with m possible values into m binary features, with only
one active.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span>  <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span> <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span> <span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span> <span class="p">]})</span>
<span class="nb">print</span> <span class="n">data</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
   x
0  1
1  1
2  2
3  3
4  3
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">dataFormat_For_OneHotEnc</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span>
<span class="c1"># converts all values to string</span>
 <span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="c1"># takes the transpose</span>
 <span class="o">.</span><span class="n">T</span>
<span class="c1"># converts the data frame to a dictionary.</span>
<span class="c1"># id s are the keys of the elements.</span>
 <span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="c1"># extracts the values out of the dictionary</span>
 <span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="nb">print</span> <span class="n">dataFormat_For_OneHotEnc</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[{&#39;x&#39;: &#39;1&#39;}, {&#39;x&#39;: &#39;1&#39;}, {&#39;x&#39;: &#39;2&#39;}, {&#39;x&#39;: &#39;3&#39;}, {&#39;x&#39;: &#39;3&#39;}]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.feature_extraction</span> <span class="kn">import</span> <span class="n">DictVectorizer</span>
<span class="n">dv</span> <span class="o">=</span> <span class="n">DictVectorizer</span><span class="p">(</span><span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">dv</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dataFormat_For_OneHotEnc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
DictVectorizer(dtype=&lt;type &#39;numpy.float64&#39;&gt;, separator=&#39;=&#39;, sort=True,
        sparse=False)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">dv</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dataFormat_For_OneHotEnc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[ 1.,  0.,  0.],
       [ 1.,  0.,  0.],
       [ 0.,  1.,  0.],
       [ 0.,  0.,  1.],
       [ 0.,  0.,  1.]])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span>  <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span> <span class="s2">&quot;x1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span> <span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span> <span class="p">],</span>
                     <span class="s2">&quot;x2&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]})</span>
<span class="nb">print</span> <span class="s1">&#39;Data: &#39;</span>
<span class="nb">print</span> <span class="n">data</span>

<span class="n">dataFormat_For_OneHotEnc</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span>
<span class="c1"># converts all values to string</span>
 <span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="c1"># takes the transpose</span>
 <span class="o">.</span><span class="n">T</span>
<span class="c1"># converts the data frame to a dictionary.</span>
<span class="c1"># id s are the keys of the elements.</span>
 <span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="c1"># extracts the values out of the dictionary</span>
 <span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="nb">print</span> <span class="s2">&quot;transformed Data for One hot encoding: &quot;</span>
<span class="nb">print</span> <span class="n">dataFormat_For_OneHotEnc</span>

<span class="n">dv</span> <span class="o">=</span> <span class="n">DictVectorizer</span><span class="p">(</span><span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">dv</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dataFormat_For_OneHotEnc</span><span class="p">)</span>
<span class="n">dv</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dataFormat_For_OneHotEnc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Data:
   x1  x2
0   1   1
1   1   1
2   2   2
3   3   2
4   3   1
transformed Data for One hot encoding:
[{&#39;x2&#39;: &#39;1&#39;, &#39;x1&#39;: &#39;1&#39;}, {&#39;x2&#39;: &#39;1&#39;, &#39;x1&#39;: &#39;1&#39;}, {&#39;x2&#39;: &#39;2&#39;, &#39;x1&#39;: &#39;2&#39;}, {&#39;x2&#39;: &#39;2&#39;, &#39;x1&#39;: &#39;3&#39;}, {&#39;x2&#39;: &#39;1&#39;, &#39;x1&#39;: &#39;3&#39;}]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[ 1.,  0.,  0.,  1.,  0.],
       [ 1.,  0.,  0.,  1.,  0.],
       [ 0.,  1.,  0.,  0.,  1.],
       [ 0.,  0.,  1.,  0.,  1.],
       [ 0.,  0.,  1.,  1.,  0.]])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.feature_extraction</span> <span class="kn">import</span> <span class="n">DictVectorizer</span>
<span class="n">dv</span> <span class="o">=</span> <span class="p">(</span><span class="n">DictVectorizer</span><span class="p">(</span><span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
      <span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trainData</span><span class="p">[</span><span class="n">factorVars</span><span class="p">]</span>
           <span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
           <span class="o">.</span><span class="n">T</span>
           <span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
           <span class="o">.</span><span class="n">values</span><span class="p">())</span>
     <span class="p">)</span>

<span class="n">catXTrain_enc</span> <span class="o">=</span> <span class="n">dv</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">trainData</span><span class="p">[</span><span class="n">factorVars</span><span class="p">]</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="nb">print</span> <span class="n">catXTrain_enc</span><span class="o">.</span><span class="n">shape</span>
<span class="nb">print</span> <span class="n">catXTrain_enc</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(20720L, 72L)
[[ 1.  0.  0. ...,  0.  0.  1.]
 [ 1.  0.  0. ...,  0.  1.  0.]
 [ 0.  1.  0. ...,  0.  1.  0.]
 ...,
 [ 0.  1.  0. ...,  0.  1.  0.]
 [ 1.  0.  0. ...,  0.  0.  1.]
 [ 0.  1.  0. ...,  0.  1.  0.]]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">factorVars</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
9
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># join every thing together.</span>
<span class="n">trainX_transformed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">trainX_std</span><span class="p">,</span> <span class="n">catXTrain_enc</span><span class="p">))</span>
<span class="nb">print</span> <span class="s2">&quot;Train data shape after transformation: &quot;</span><span class="p">,</span> <span class="n">trainX_transformed</span><span class="o">.</span><span class="n">shape</span>

<span class="n">trainY</span> <span class="o">=</span> <span class="n">trainData</span><span class="p">[</span><span class="n">response</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="nb">print</span> <span class="s2">&quot;Feature Set for Training: &quot;</span>
<span class="nb">print</span> <span class="n">trainX_transformed</span>

<span class="nb">print</span> <span class="s2">&quot;Response for Training: &quot;</span>
<span class="nb">print</span> <span class="n">trainY</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Train data shape after transformation:  (20720L, 87L)
Feature Set for Training:
[[ 1.27604837  0.25208229  0.38674939 ...,  0.          0.          1.        ]
 [ 1.09678812  1.1013788  -0.26541316 ...,  0.          1.          0.        ]
 [ 1.72437213 -1.13767563 -0.70018819 ...,  0.          1.          0.        ]
 ...,
 [-0.8982757  -0.0567528   2.88670582 ...,  0.          1.          0.        ]
 [-0.94560133 -0.82884053 -1.13496323 ...,  0.          0.          1.        ]
 [-1.16803179  0.32929107 -0.59149443 ...,  0.          1.          0.        ]]
Response for Training:
[0 0 1 ..., 0 0 0]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">ar1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>  <span class="p">[[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">],</span>
                  <span class="p">[</span><span class="mi">21</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">23</span><span class="p">]])</span>

<span class="n">ar2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span>
              <span class="p">[</span><span class="mi">24</span><span class="p">,</span> <span class="mi">25</span><span class="p">]])</span>

<span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">ar1</span><span class="p">,</span> <span class="n">ar2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[11, 12, 13, 14, 15],
       [21, 22, 23, 24, 25]])
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># implement the pre processing pipeline as a function.</span>
<span class="k">def</span> <span class="nf">preProcessing</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">scalarObj</span><span class="p">,</span> <span class="n">encodingObj</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    input:</span>
<span class="sd">        dataframe: the dataframe for which pre processing needs to be done.</span>
<span class="sd">        scalarObj: the object returned by preprocessing.scalar.fit</span>
<span class="sd">        encodingObj: the object returned after encoding categorical variables.</span>

<span class="sd">    output:</span>
<span class="sd">        2 objects:</span>
<span class="sd">            transformed set of features</span>
<span class="sd">            response</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">NumX</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">numericVars</span><span class="p">]</span>
    <span class="n">CatX</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">factorVars</span><span class="p">]</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">response</span><span class="p">]</span>

    <span class="c1"># standardize the numeric variables.</span>
    <span class="n">NumX_std</span> <span class="o">=</span> <span class="n">scalarObj</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">NumX</span><span class="p">)</span>

    <span class="c1"># encode the categorical variables.</span>
    <span class="n">CatX_enc</span> <span class="o">=</span> <span class="n">encodingObj</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">CatX</span>
                                <span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
                                <span class="o">.</span><span class="n">T</span>
                                <span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
                                <span class="o">.</span><span class="n">values</span><span class="p">()</span>
                               <span class="p">)</span>

    <span class="c1"># create the transformed training set.</span>
    <span class="n">X_transformed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">NumX_std</span><span class="p">,</span> <span class="n">CatX_enc</span><span class="p">))</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">response</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">X_transformed</span><span class="p">,</span> <span class="n">Y</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">trainX_transformed</span><span class="p">,</span> <span class="n">trainY</span> <span class="o">=</span> <span class="n">preProcessing</span><span class="p">(</span><span class="n">trainData</span><span class="p">,</span> <span class="n">scaler</span><span class="p">,</span> <span class="n">dv</span><span class="p">)</span>
<span class="n">testX_transformed</span><span class="p">,</span> <span class="n">testY</span> <span class="o">=</span> <span class="n">preProcessing</span><span class="p">(</span><span class="n">testData</span><span class="p">,</span>  <span class="n">scaler</span><span class="p">,</span> <span class="n">dv</span><span class="p">)</span>
<span class="n">validationX_transformed</span><span class="p">,</span> <span class="n">validation_Y</span> <span class="o">=</span> <span class="n">preProcessing</span><span class="p">(</span><span class="n">validateData</span><span class="p">,</span> <span class="n">scaler</span><span class="p">,</span> <span class="n">dv</span><span class="p">)</span>

<span class="nb">print</span> <span class="s2">&quot;Transformed training split: &quot;</span>
<span class="nb">print</span> <span class="n">trainX_transformed</span>

<span class="nb">print</span> <span class="s2">&quot;Transformed testing split: &quot;</span>
<span class="nb">print</span> <span class="n">testX_transformed</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Transformed training split:
[[ 1.27604837  0.25208229  0.38674939 ...,  0.          0.          1.        ]
 [ 1.09678812  1.1013788  -0.26541316 ...,  0.          1.          0.        ]
 [ 1.72437213 -1.13767563 -0.70018819 ...,  0.          1.          0.        ]
 ...,
 [-0.8982757  -0.0567528   2.88670582 ...,  0.          1.          0.        ]
 [-0.94560133 -0.82884053 -1.13496323 ...,  0.          0.          1.        ]
 [-1.16803179  0.32929107 -0.59149443 ...,  0.          1.          0.        ]]
Transformed testing split:
[[-1.48569064  0.63812616  0.71283066 ...,  0.          0.          1.        ]
 [ 1.63364543  1.02417003  1.58238073 ...,  0.          0.          1.        ]
 [-1.40489079 -0.90604931  1.58238073 ...,  0.          0.          1.        ]
 ...,
 [ 1.73429897  1.48742266 -0.04802564 ...,  0.          1.          0.        ]
 [-1.52609057 -0.21117035  2.01715576 ...,  0.          1.          0.        ]
 [ 0.81421949 -0.75163176 -1.13496323 ...,  0.          0.          1.        ]]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
<span class="n">neigh</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">3</span> <span class="p">)</span>
<span class="n">neigh</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trainX_transformed</span><span class="p">,</span> <span class="n">trainY</span><span class="p">)</span>
<span class="nb">print</span> <span class="n">neigh</span><span class="o">.</span><span class="n">fit</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;bound method KNeighborsClassifier.fit of KNeighborsClassifier(algorithm=&#39;auto&#39;, leaf_size=30, metric=&#39;minkowski&#39;,
           metric_params=None, n_jobs=1, n_neighbors=3, p=2,
           weights=&#39;uniform&#39;)&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">insampleScores</span> <span class="o">=</span> <span class="n">neigh</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">trainX_transformed</span><span class="p">)</span>
<span class="nb">print</span> <span class="n">insampleScores</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[[ 1.          0.        ]
 [ 0.66666667  0.33333333]
 [ 0.66666667  0.33333333]
 ...,
 [ 1.          0.        ]
 [ 0.66666667  0.33333333]
 [ 1.          0.        ]]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">insamplePredictions</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="n">eachScore</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">eachScore</span> <span class="ow">in</span> <span class="n">insampleScores</span>  <span class="p">]</span>
<span class="nb">print</span> <span class="n">insamplePredictions</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
<span class="nb">print</span> <span class="s2">&quot;Accuracy: &quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">insamplePredictions</span> <span class="o">==</span> <span class="n">trainY</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[0, 0, 0, 0, 0, 0, 1, 0, 0, 0]
Accuracy:  0.861293436293
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">insamplePredictions</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="n">eachScore</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">eachScore</span> <span class="ow">in</span> <span class="n">insampleScores</span>  <span class="p">]</span>
<span class="nb">print</span> <span class="n">insamplePredictions</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
<span class="nb">print</span> <span class="s2">&quot;Accuracy: &quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">insamplePredictions</span> <span class="o">==</span> <span class="n">trainY</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[0, 1, 1, 1, 1, 0, 1, 1, 0, 1]
Accuracy:  0.767326254826
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the predictions on the training data: In sample predictions!</span>
<span class="n">insamplePredictions</span> <span class="o">=</span> <span class="n">neigh</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">trainX_transformed</span><span class="p">)</span>
<span class="nb">print</span> <span class="n">insamplePredictions</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[0 0 0 ..., 0 0 0]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">dt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;observed&quot;</span><span class="p">:</span> <span class="n">trainY</span><span class="p">,</span>
                    <span class="s2">&quot;predicted&quot;</span><span class="p">:</span> <span class="n">insamplePredictions</span><span class="p">})</span>
<span class="nb">print</span> <span class="n">dt</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="s1">&#39;observed&#39;</span><span class="p">],</span> <span class="n">dt</span><span class="p">[</span><span class="s1">&#39;predicted&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
   observed  predicted
0         0          0
1         0          0
2         1          0
3         0          0
4         1          0
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>predicted</th>
      <th>0</th>
      <th>1</th>
    </tr>
    <tr>
      <th>observed</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>15253</td>
      <td>804</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2070</td>
      <td>2593</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># How good was the prediction on the training data ?</span>
<span class="nb">print</span> <span class="s1">&#39;In Sample Accuracy: &#39;</span><span class="p">,</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">trainY</span> <span class="o">==</span> <span class="n">insamplePredictions</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Working with the test split.</span>
<span class="c1"># Implement the pre processing pipeline on the test split.</span>
<span class="n">testX_transformed</span><span class="p">,</span> <span class="n">testY</span> <span class="o">=</span> <span class="n">preProcessing</span><span class="p">(</span><span class="n">testData</span><span class="p">,</span>  <span class="n">scaler</span><span class="p">,</span> <span class="n">dv</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># now predict on the testX_transformed data.</span>
<span class="n">oosPred_test</span> <span class="o">=</span> <span class="n">neigh</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">testX_transformed</span><span class="p">)</span>
<span class="nb">print</span> <span class="n">oosPred_test</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">oosAccuracyTest</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">testY</span> <span class="o">==</span> <span class="n">oosPred_test</span><span class="p">)</span>
<span class="nb">print</span> <span class="s2">&quot;Accuracy on the testing split: &quot;</span><span class="p">,</span> <span class="n">oosAccuracyTest</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">validationX_transformed</span><span class="p">,</span> <span class="n">validation_Y</span> <span class="o">=</span> <span class="n">preProcessing</span><span class="p">(</span><span class="n">validateData</span><span class="p">,</span> <span class="n">scaler</span><span class="p">,</span> <span class="n">dv</span><span class="p">)</span>
<span class="n">oosPred_validation</span> <span class="o">=</span> <span class="n">neigh</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">validationX_transformed</span><span class="p">)</span>
<span class="n">oosAccuracyValidation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">validation_Y</span> <span class="o">==</span> <span class="n">oosPred_validation</span><span class="p">)</span>
<span class="nb">print</span> <span class="s2">&quot;Accuracy on the validation split: &quot;</span><span class="p">,</span> <span class="n">oosAccuracyValidation</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">N_grid</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">oosAccuracyList</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">eachN</span> <span class="ow">in</span> <span class="n">N_grid</span><span class="p">:</span>
<span class="c1">#      fit the nearest neighbour for each</span>
<span class="c1">#       value in the set of candidate values.</span>
    <span class="n">neigh</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span> <span class="n">eachN</span><span class="p">)</span>
    <span class="n">neigh</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trainX_transformed</span><span class="p">,</span> <span class="n">trainY</span><span class="p">)</span>


<span class="c1">#     using the fitted model get the predictions</span>
<span class="c1">#     on the testing split.</span>
    <span class="n">oosPred_test</span> <span class="o">=</span> <span class="n">neigh</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">testX_transformed</span><span class="p">)</span>

<span class="c1">#     Calculate the accuracy on the test split.</span>
    <span class="n">oosAccuracyTest</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">testY</span> <span class="o">==</span> <span class="n">oosPred_test</span><span class="p">)</span>

<span class="c1">#     Add it to the list</span>
    <span class="n">oosAccuracyList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">oosAccuracyTest</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">N_grid</span><span class="p">,</span> <span class="n">oosAccuracyList</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Fitting-a-random-forest-classifier">
<h1>Fitting a random forest classifier<a class="headerlink" href="#Fitting-a-random-forest-classifier" title="Permalink to this heading"></a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[70]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="n">rf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">()</span>
<span class="n">rf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trainX_transformed</span><span class="p">,</span> <span class="n">trainY</span><span class="p">)</span>

<span class="nb">print</span> <span class="n">rf</span>
<span class="n">oosPredictRF_test</span> <span class="o">=</span> <span class="n">rf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">testX_transformed</span><span class="p">)</span>
<span class="nb">print</span> <span class="s1">&#39;Out of sample Accuracy for random forests: &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">testY</span> <span class="o">==</span> <span class="n">oosPredictRF_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifier(bootstrap=True, class_weight=None, criterion=&#39;gini&#39;,
            max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,
            min_samples_leaf=1, min_samples_split=2,
            min_weight_fraction_leaf=0.0, n_estimators=10, n_jobs=1,
            oob_score=False, random_state=None, verbose=0,
            warm_start=False)
Out of sample Accuracy for random forests:  0.805405405405
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Tuning the random forest classifier. RF&#39;s have 2 tuning parameters: n_estimators &amp; max_features</span>

<span class="c1"># create a 2 dimensional grid of candidate_values:</span>
<span class="n">grid_n_estimators</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">]</span>
<span class="n">max_features</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">]</span>

<span class="kn">import</span> <span class="nn">itertools</span>
<span class="n">grid2D</span> <span class="o">=</span> <span class="p">[</span><span class="n">element</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">grid_n_estimators</span><span class="p">,</span> <span class="n">max_features</span><span class="p">)]</span>
<span class="nb">print</span> <span class="n">grid2D</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">oosAccuracyList_RF</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="k">for</span> <span class="n">eachVal</span> <span class="ow">in</span> <span class="n">grid2D</span><span class="p">:</span>
    <span class="n">rf</span> <span class="o">=</span> <span class="p">(</span><span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span> <span class="n">eachVal</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                 <span class="n">max_features</span><span class="o">=</span> <span class="n">eachVal</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                <span class="n">n_jobs</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
          <span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trainX_transformed</span><span class="p">,</span> <span class="n">trainY</span><span class="p">))</span>
    <span class="n">oosPredictRF_test</span> <span class="o">=</span> <span class="n">rf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">testX_transformed</span><span class="p">)</span>
    <span class="n">oosAccuracyList_RF</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">testY</span> <span class="o">==</span> <span class="n">oosPredictRF_test</span><span class="p">))</span>

<span class="nb">print</span> <span class="n">oosAccuracyList_RF</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="nb">zip</span><span class="p">(</span><span class="n">grid2D</span><span class="p">,</span> <span class="n">oosAccuracyList_RF</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># final model: rf with n_estimators  = 100, max_features = 10</span>
<span class="n">finalModel</span> <span class="o">=</span> <span class="p">(</span><span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
                                    <span class="n">max_features</span><span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
              <span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trainX_transformed</span><span class="p">,</span>
                   <span class="n">trainY</span><span class="p">)</span>
              <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Performance on the validation set.</span>
<span class="n">oosAccuracy_validation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">validation_Y</span> <span class="o">==</span> <span class="n">finalModel</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">validationX_transformed</span><span class="p">))</span>
<span class="nb">print</span> <span class="n">oosAccuracy_validation</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">trainY</span><span class="p">)</span>
</pre></div>
</div>
</div>
<section id="Advanced-Topics-in-Machine-Learning!">
<h2>Advanced Topics in Machine Learning!<a class="headerlink" href="#Advanced-Topics-in-Machine-Learning!" title="Permalink to this heading"></a></h2>
<section id="Getting-scores-from-classifiers">
<h3>Getting scores from classifiers<a class="headerlink" href="#Getting-scores-from-classifiers" title="Permalink to this heading"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">neigh</span> <span class="o">=</span>  <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">n_neighbors</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">neigh</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trainX_transformed</span><span class="p">,</span> <span class="n">trainY</span><span class="p">)</span>

<span class="n">oosProb</span> <span class="o">=</span> <span class="n">neigh</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">testX_transformed</span><span class="p">)</span>
<span class="nb">print</span> <span class="n">oosProb</span>

<span class="n">oosOutcome</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.5</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">oosProb</span> <span class="p">]</span>
<span class="nb">print</span> <span class="n">oosOutcome</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
<span class="nb">print</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">oosOutcome</span> <span class="o">==</span> <span class="n">testY</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">oosOutcome</span> <span class="o">=</span> <span class="n">neigh</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">testX_transformed</span><span class="p">)</span>
<span class="nb">print</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">oosOutcome</span> <span class="o">==</span> <span class="n">testY</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># change the threshold to 0.6</span>
<span class="n">oosOutcome</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.6</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">oosProb</span> <span class="p">]</span>
<span class="nb">print</span> <span class="n">oosOutcome</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
<span class="nb">print</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">oosOutcome</span> <span class="o">==</span> <span class="n">testY</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Computing-Sensitivity,-Specificity-from-Confusion-Matrix">
<h3>Computing Sensitivity, Specificity from Confusion Matrix<a class="headerlink" href="#Computing-Sensitivity,-Specificity-from-Confusion-Matrix" title="Permalink to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span>
<span class="nb">print</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">trainY</span><span class="p">,</span> <span class="n">insamplePredictions</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[[15253   804]
 [ 2070  2593]]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calculate_metrics</span><span class="p">(</span><span class="n">confusionMatrix</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute sensitivity and specificity</span>
<span class="sd">    from a confusion matrix</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tp</span> <span class="o">=</span> <span class="n">confusionMatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">tn</span> <span class="o">=</span> <span class="n">confusionMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">confusionMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="n">confusionMatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">sens</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tp</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fn</span><span class="p">)</span>
    <span class="n">spec</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tn</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">tn</span> <span class="o">+</span> <span class="n">fp</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sens</span><span class="p">,</span> <span class="n">spec</span>

<span class="nb">print</span> <span class="s1">&#39;Sensitivity (TPR) : &#39;</span><span class="p">,</span> <span class="n">calculate_metrics</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">trainY</span><span class="p">,</span> <span class="n">insamplePredictions</span> <span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span> <span class="s1">&#39;Specificity (1 - FPR): &#39;</span><span class="p">,</span> <span class="n">calculate_metrics</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">trainY</span><span class="p">,</span> <span class="n">insamplePredictions</span> <span class="p">))[</span><span class="mi">1</span><span class="p">]</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Sensitivity (TPR) :  0.556079776968
Specificity (1 - FPR):  0.949928380146
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">insamplePredictions</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="n">eachScore</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">eachScore</span> <span class="ow">in</span> <span class="n">insampleScores</span>  <span class="p">]</span>

<span class="nb">print</span> <span class="s2">&quot;Accuracy: &quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">insamplePredictions</span> <span class="o">==</span> <span class="n">trainY</span><span class="p">)</span>
<span class="nb">print</span> <span class="s1">&#39;Sensitivity (TPR) : &#39;</span><span class="p">,</span> <span class="n">calculate_metrics</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">trainY</span><span class="p">,</span> <span class="n">insamplePredictions</span> <span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span> <span class="s1">&#39;Specificity (1 - FPR): &#39;</span><span class="p">,</span> <span class="n">calculate_metrics</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">trainY</span><span class="p">,</span> <span class="n">insamplePredictions</span> <span class="p">))[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Accuracy:  0.767326254826
Sensitivity (TPR) :  1.0
Specificity (1 - FPR):  0.699757115277
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.9</span>
<span class="n">insamplePredictions</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="n">eachScore</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">eachScore</span> <span class="ow">in</span> <span class="n">insampleScores</span>  <span class="p">]</span>

<span class="nb">print</span> <span class="s2">&quot;Accuracy: &quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">insamplePredictions</span> <span class="o">==</span> <span class="n">trainY</span><span class="p">)</span>
<span class="nb">print</span> <span class="s1">&#39;Sensitivity (TPR) : &#39;</span><span class="p">,</span> <span class="n">calculate_metrics</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">trainY</span><span class="p">,</span> <span class="n">insamplePredictions</span> <span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span> <span class="s1">&#39;Specificity (1 - FPR): &#39;</span><span class="p">,</span> <span class="n">calculate_metrics</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">trainY</span><span class="p">,</span> <span class="n">insamplePredictions</span> <span class="p">))[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Accuracy:  0.819739382239
Sensitivity (TPR) :  0.199013510615
Specificity (1 - FPR):  1.0
</pre></div></div>
</div>
</section>
<section id="Plotting-ROC">
<h3>Plotting ROC<a class="headerlink" href="#Plotting-ROC" title="Permalink to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[55]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">roc_curve</span>
<span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">trainY</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">insampleScores</span> <span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[55]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;matplotlib.lines.Line2D at 0xaa652e8&gt;]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/AI_statistic_2_exploratory_data_analysis_exploratory_machineLearning_90_1.png" src="../../../_images/AI_statistic_2_exploratory_data_analysis_exploratory_machineLearning_90_1.png" />
</div>
</div>
</section>
<section id="Calculating-Area-under-the-ROC-curve">
<h3>Calculating Area under the ROC curve<a class="headerlink" href="#Calculating-Area-under-the-ROC-curve" title="Permalink to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">roc_auc_score</span>
<span class="nb">print</span> <span class="s2">&quot;Area under the ROC Curve :&quot;</span><span class="p">,</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">trainY</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">insampleScores</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
 Area under the ROC Curve : 0.913304710322
</pre></div></div>
</div>
<section id="Selecting-tuning-parameters-in-K-nearest-neighbour-using-combination-of-grid-search-and-cross-validation.-The-error-metric-is-AUC-instead-of-accuracy">
<h4>Selecting tuning parameters in K nearest neighbour using combination of grid search and cross validation. The error metric is AUC instead of accuracy<a class="headerlink" href="#Selecting-tuning-parameters-in-K-nearest-neighbour-using-combination-of-grid-search-and-cross-validation.-The-error-metric-is-AUC-instead-of-accuracy" title="Permalink to this heading"></a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">cross_validation</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">roc_auc_score</span><span class="p">,</span> <span class="n">auc</span><span class="p">,</span> <span class="n">roc_curve</span>
<span class="c1"># grid for searching optimal value of K in K-nearest neighbour.</span>
<span class="n">K_grid</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>
<span class="c1"># set up the folds of data for cross validation.</span>
<span class="n">cv_folds</span> <span class="o">=</span> <span class="n">cross_validation</span><span class="o">.</span><span class="n">KFold</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">trainY</span><span class="p">),</span>
                                 <span class="n">n_folds</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
                                 <span class="n">shuffle</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                 <span class="n">random_state</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">aucList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="k">for</span> <span class="n">eachK</span> <span class="ow">in</span> <span class="n">K_grid</span><span class="p">:</span>
<span class="c1"># Keep appending to this list.</span>
    <span class="n">eachAUC</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">trainInd</span><span class="p">,</span> <span class="n">testInd</span> <span class="ow">in</span> <span class="n">cv_folds</span><span class="p">:</span>
<span class="c1"># Prepare the training data</span>
        <span class="n">forTrainX</span> <span class="o">=</span> <span class="n">trainX_transformed</span><span class="p">[</span><span class="n">trainInd</span><span class="p">]</span>
        <span class="n">forTrainY</span> <span class="o">=</span> <span class="n">trainY</span><span class="p">[</span><span class="n">trainInd</span><span class="p">]</span>
<span class="c1"># Prepare the testing data</span>
        <span class="n">forTestX</span> <span class="o">=</span> <span class="n">trainX_transformed</span><span class="p">[</span><span class="n">testInd</span><span class="p">]</span>
        <span class="n">forTestY</span> <span class="o">=</span> <span class="n">trainY</span><span class="p">[</span><span class="n">testInd</span><span class="p">]</span>
<span class="c1"># Instantiate the model object in each case.</span>
        <span class="n">neigh</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">n_neighbors</span> <span class="o">=</span> <span class="n">eachK</span><span class="p">)</span>
        <span class="n">neigh</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">forTrainX</span><span class="p">,</span> <span class="n">forTrainY</span><span class="p">)</span>
<span class="c1"># out of sample prediction probabilities</span>
        <span class="n">oosProb</span> <span class="o">=</span> <span class="n">neigh</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">forTestX</span><span class="p">)</span>
<span class="c1"># Calculate the auc.</span>
        <span class="n">rocVal</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">forTestY</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">oosProb</span><span class="p">])</span>
        <span class="n">eachAUC</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rocVal</span><span class="p">)</span>

    <span class="n">aucList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eachAUC</span><span class="p">)</span>

<span class="nb">zip</span><span class="p">(</span><span class="n">K_grid</span><span class="p">,</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">aucList</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[(3, 0.66516976264208438), (5, 0.69248410947492811), (7, 0.70473326362029309)]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">aucList</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[[0.66953523097728573, 0.668695325730992, 0.65727873121797542],
 [0.70012977339135984, 0.68659516989385927, 0.69072738513956522],
 [0.71146583920003925, 0.70091196710882886, 0.70182198455201117]]
</pre></div></div>
</div>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, David TBO.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>